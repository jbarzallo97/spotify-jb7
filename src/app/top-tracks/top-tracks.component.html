<div class="profile-container">
  <div class="profile-header">
    <div class="content-container">
      <h1>Top Tracks</h1>
      <div class="time-period-container">
        <button class="time-period" [ngClass]="{ 'active': selectedPeriod === 'allTime' }" (click)="selectPeriod('allTime')">All Time</button>
        <button class="time-period" [ngClass]="{ 'active': selectedPeriod === 'last6Months' }" (click)="selectPeriod('last6Months')">Last 6 Months</button>
        <button class="time-period" [ngClass]="{ 'active': selectedPeriod === 'last4Weeks' }" (click)="selectPeriod('last4Weeks')">Last 4 Weeks</button>
      </div>
    </div>
  </div>

  <div class="tracks-container">
    <div *ngIf="isLoading" class="loading-wrapper">
      <div class="equalizer">
        <span></span><span></span><span></span><span></span><span></span>
      </div>
    </div>

    <div *ngIf="!isLoading && tracks.length === 0" class="empty-state">No hay canciones para mostrar.</div>

    <ng-container *ngIf="!isLoading && tracks.length > 0">
      <div class="track-item" *ngFor="let t of paginatedTracks" (click)="openTrackModal(t.id)">
        <div class="left">
          <img [src]="t.imageUrl" [alt]="t.title" />
          <div class="meta">
            <p class="title">{{ t.title }}</p>
            <p class="artists">{{ t.artists }}</p>
          </div>
        </div>
        <div class="right">
          <span class="duration">{{ t.duration }}</span>
          <audio *ngIf="t.previewUrl" [src]="t.previewUrl" controls (click)="$event.stopPropagation()"></audio>
        </div>
      </div>

      <div class="pagination">
        <button class="pager" (click)="prevPage()" [disabled]="currentPage === 1">Anterior</button>
        <span class="page-indicator">{{ currentPage }} / {{ totalPages }}</span>
        <button class="pager" (click)="nextPage()" [disabled]="currentPage === totalPages">Siguiente</button>
      </div>
    </ng-container>
  </div>

  <!-- Modal de track -->
  <div class="modal-backdrop" *ngIf="isModalOpen" (click)="closeModal()"></div>
  <div class="modal" *ngIf="isModalOpen">
    <button class="modal-close" (click)="closeModal()">&times;</button>
    <div class="modal-body" *ngIf="isTrackLoading">
      <div class="modal-loading">
        <div class="equalizer">
          <span></span><span></span><span></span><span></span><span></span>
        </div>
      </div>
    </div>
    <div class="modal-body" *ngIf="!isTrackLoading && selectedTrack">
      <div class="modal-track">
        <img *ngIf="selectedTrack?.album?.images?.length" [src]="selectedTrack.album.images[0].url" [alt]="selectedTrack.name">
        <div class="info">
          <h3 class="track-title">{{ selectedTrack.name }}</h3>
          <p class="artists">{{ getArtistsList(selectedTrack.artists) }}</p>

          <div class="meta-row">
            <span class="pill"><i class="far fa-clock"></i>{{ (selectedTrack.duration_ms / 1000 / 60) | number:'1.0-0' }}m {{ (selectedTrack.duration_ms / 1000) % 60 | number:'2.0-0' }}s</span>
            <span class="pill"><i class="fas fa-star"></i>{{ selectedTrack.popularity }}% Popularidad</span>
            <span class="pill" *ngIf="selectedTrack?.external_ids?.isrc"><i class="fas fa-barcode"></i>{{ selectedTrack.external_ids.isrc }}</span>
          </div>

          <div class="divider"></div>

          <p class="album-line"><i class="fas fa-compact-disc"></i> Álbum: <span class="album-name">{{ selectedTrack.album?.name }}</span> <span class="album-date">({{ getAlbumReleaseDate(selectedTrack) }})</span></p>
          <p class="sub-stats">Track # {{ selectedTrack.track_number }} • Disco {{ selectedTrack.disc_number }}</p>

          <div class="actions">
            <a class="open-spotify" [href]="selectedTrack?.external_urls?.spotify" target="_blank" rel="noopener">Abrir en Spotify</a>
            <button class="copy-link" (click)="copyLink(selectedTrack?.external_urls?.spotify)"><i class="fas fa-link"></i> Copiar enlace</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
